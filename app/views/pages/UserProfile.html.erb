<h1>Προφίλ Χρήστη</h1>

<%=link_to "Αναζήτηση για στατιστικά στοιχεία οχημάτων", vehicles_path%>

<div >
		
		<select id='graph_type' name="graph_type">
			<option value="none">Επιλογή Γραφήματος</option>
			<option value="Euro-liter">Τιμή-Λίτρα</option>
  			<option value="Stations">Απεικόνιση γεμισμάτων στους σταθμούς</option>
		</select>
	</div>
<div id="graph" style="display:none;">
	
	<script> 
		//console.log($("#graph_type").val());
		$("#graph_type").change(function (){
			var date=<%=@date_pinakas%>;
			
			if($("#graph_type").val()==="Euro-liter"){
				document.getElementById('graph').style.display = 'block'
				
				var liters=<%=@litra_pinakas%>;
				var price=<%=@timh_pinakas%>;
				var vehicle_list=<%=@vehicle_list%>;
				        
				//var title_graph="<%=@titlos%>";


				var litersArray = [];
				var priceArray = [];
				var priorDate ;

				for (i=0;i<date.length;i++){
					priorDate= new Date(date[i]).getTime()+11000000;
					priorDate= new Date(priorDate);              
				    litersArray.push({
				    	name:'Vehicle: '+vehicle_list[i]+', '+'Date: '+ priorDate,
					    //date  
					    x:new Date(date[i]),
					    //litra
					    y:liters[i]              
				    });
				    priceArray.push({
				    	name:'Vehicle: '+vehicle_list[i]+', '+'Date: '+ priorDate,
					    //date  
					    x:new Date(date[i]),
					    //timh
					    y:price[i]              
				    });
				    
				}

				Highcharts.chart('graph', {
				    chart: {
				        type: 'column'
				    },
				    title: {
				        text: 'Τιμή Αγοράς Λίτρων καυσίμου'
				    },
				    xAxis: {

				        type: 'datetime'
				    },
				    yAxis: [{
				        min: 0,
				        title: {
				            text: 'Liters(lt)'
				        }
				    }, {
				        title: {
				            text: 'Euro(€)'
				        },
				        opposite: true
				    }],
				    legend: {
				        shadow: false
				    },
				    tooltip: {
				        shared: true
				    },
				    plotOptions: {
				        column: {
				            grouping: false,
				            shadow: false,
				            borderWidth: 0
				        }
				    },
				    /*tooltip: {
				        formatter: function() {
				          return 'Extra data: <b>' + this.point.myData + '</b>';
				        }
				    },*/
				    series: [{
				        name: 'Λίτρα',
				        color: 'rgba(165,170,217,1)',
				        data: litersArray,
				        tooltip: {
				            valueSuffix: ' lt'
				        },
				        pointPadding: 0.1,
				        pointPlacement: -0.2
				    },  {
				        name: 'Τιμή',
				        color: 'rgba(186,60,61,.9)',
				        data: priceArray,
				        tooltip: {
				            valueSuffix: ' €'
				        },
				        pointPadding: 0.1,
				        pointPlacement: 0.2,
				        yAxis: 1
				    }]
				});
			}
			else if($("#graph_type").val()==="Stations"){
				document.getElementById('graph').style.display = 'block'
				var categories_list=<%=@categories_list%>;
				var station_list=<%=@station_list%>;
				var vehicle_list=<%=@vehicle_list%>;
				var name_list=<%=@name_list%>;
				var myArr = [];
				var data=[];
				var series = [];
				var colours= [];
				
				for(j=0;j<name_list.length;j++){
					colours[j]=setRandomColour();
				}
				console.log(colours);
				for (i=0;i<station_list.length;i++){     
					var station_name=station_list[i];
					var position;
					for(j=0;j<categories_list.length;j++){
						if(station_name===categories_list[j]){
							position=j;
						}
					}
					var oxhma;
					var colourPicker;
					var priorDate ;
					var postDate;
					
					for(j=0;j<name_list.length;j++){
						if(vehicle_list[i]===name_list[j]){
							oxhma=name_list[j];
							colourPicker=colours[j]
							priorDate= new Date(date[i]).getTime()+11000000;
							priorDate= new Date(priorDate);
							postDate= new Date(date[i+1]).getTime()+11000000;
							postDate= new Date(postDate);
							console.log(vehicle_list[i],date[i]);
						}
					}
					if(vehicle_list[i]===vehicle_list[i+1]){   
			            series.push({
				            myData: 'Vehicle: '+oxhma+', '+'Date: '+ priorDate+' - '+postDate,
				            //date first
				            x:new Date(priorDate).getTime()+11000000,
				            //date last
				            x2:new Date(postDate).getTime()+11000000,
				            //katanalwsh
				            y:position,
				            color: colourPicker           
			            });
		        	}
		        	else{
		        		//anazhthse ston pinaka vehicle_list an uparxei allo oxhma me to idio name kai an nai balto sto grafhma
		        		var nextPos=i+1;
		        		var searchPos=0;
		        		searchPos=search(nextPos,oxhma,vehicle_list);
		        		if(searchPos!=0){
		        			console.log("edw exw to position apo to oxhma", oxhma,searchPos);
		        			priorDate= new Date(date[i]).getTime()+11000000;
							priorDate= new Date(priorDate);
							postDate= new Date(date[searchPos]).getTime()+11000000;
							postDate= new Date(postDate);
		        			series.push({
					            myData: 'Vehicle: '+oxhma+', '+'Date: '+ priorDate+' - '+postDate,
					            //date first
					            x:new Date(priorDate).getTime()+11000000,
					            //date last
					            x2:new Date(postDate).getTime()+11000000,
					            //katanalwsh
					            y:position,
					            color: colourPicker           
			            	});
		        		}
		        	}
        		}
        		console.log(series);
        		/*for(i=0;i<vehicle_list.length-1;i++){
        			var station_name=station_list[i];
        			var pinakas=[];
        			var position;
        			
					for(j=0;j<categories_list.length;j++){
						if(station_name===categories_list[j]){
							position=j;
						}
					}
					var oxhma;
					for(j=0;j<name_list.length;j++){
						if(vehicle_list[i]===name_list[j]){
							oxhma=vehicle_list[i];
						}
					}
					if(vehicle_list[i]===vehicle_list[i+1]){
						pinakas=setDataToArray(date[i],date[i+1],position);
        			data.push({
                        name: oxhma,
                        borderRadius: 5,
                      	pointWidth: 20,
                        data: pinakas
                	});
					}
        			
        		}
				console.log(data);        
				/*
					data.push({
                        name: nameList[i],
                      
                        data: pinakas
                });


				for (i=0;i<5;i++){
					for (j=0;j<5;j++){
				  	for (k=0;k<5;k++){
				    	//x
				      //myArr[i][j][k]=Date.UTC(2014, 10, 21);
				      //x2
				      
				      //y
						}
					}
				}*/
				Highcharts.chart('graph', {
				    chart: {
				        type: 'xrange'
				    },
				    title: {
				        text: 'Γεμίσματα οχημάτων ανά σταθμό'
				    },
				    xAxis: {
				        type: 'datetime'
				    },
				    yAxis: {
				        title: {
				            text: 'Πρατήρια'
				        },
				        categories: categories_list,
				        reversed: true,
				        
				    },
				    tooltip: {
			        formatter: function() {
			          return '<b>' + this.point.myData + '</b>';
			        }},
				    series: /*data */[{
				        //name: 'Project 1',
				        // pointPadding: 0,
				        // groupPadding: 0,
				        //borderColor: 'gray',
				        pointWidth: 20,
				        
				        data: series,
				        
				    }]

				});
			}
			else{
				document.getElementById('graph').style.display = 'none'
			}

		});
		function setDataToArray(x,x2,position){
	    	var array=[];
		    //for(j=first;j<last;j++){
		                    array.push({
		                    //date  
		                    x:new Date(x).getTime()+11000000,
		                    //date2
		                    x2:new Date(x2).getTime()+11000000,
		                    //katanalwsh
		                    y:position              
		                    });                
		    //} 
		    return array;
		}
		function setRandomColour() {
		  var letters = '0123456789ABCDEF';
		  var color = '#';
		  for (i = 0; i < 6; i++) {
		    color += letters[Math.floor(Math.random() * 16)];
		  }
		  console.log(color);
		  return color;
		}
		function search(start,vehicle,array){
			var newPos=0;
			
			for (k = start; k < array.length; k++) {
				
		    	if(vehicle===array[k]){
		    		newPos=k;
		    		return newPos;
		    	}
		  	}
		  	return newPos;
		}
	</script>
</div>

<p>Τα οχήματα μου και οι καταχωρήσεις μου</p>
<%= render 'pages/show_vehicle' %>